---
title: "Dendroclima"
author: "Muraja DOS"
date: "2023-04-07"
output: pdf_document
---


```{r}
cat("\014") 
rm(list=ls()) 
getwd() 
```

**SEASONAL**
*create the correlations + p-values but put it as a data.frame*
```{r}
tree_ring_df <- read.table('Chronology_Stabilized_trees_canela.txt', header = TRUE)
SUNSPOT <- read.table("SUNSPOT_data.txt", header = FALSE)

# Extract the relevant variables from the data
#rwi <- tree_ring_df$RWI[1:nrow(SUNSPOT)]  # Subset the first 31 rows of RWI

Years <- SUNSPOT[,1]
row.names(SUNSPOT) <- Years
SUNSPOT <- SUNSPOT[,-1]

# Define the months corresponding to each season
season_months <- list(
  Summer = c(12, 1, 2),
  Autumn = c(3, 4, 5),
  Winter = c(6, 7, 8),
  Spring = c(9, 10, 11)
)

# Create a function to calculate seasonal means
calculate_seasonal_means <- function(data, months) {
  seasons <- lapply(months, function(x) rowMeans(data[, x, drop = FALSE], na.rm = TRUE))
  seasons_df <- as.data.frame(do.call(cbind, seasons))
  colnames(seasons_df) <- names(months)
  return(seasons_df)
}

# Calculate seasonal means for temperature_med
SUNSPOT_seasons <- calculate_seasonal_means(SUNSPOT, season_months)

# Set the significance level (alpha)
alpha <- 0.05

# Extract the relevant columns for correlation
rwi <- tree_ring_df[, 1]
climatic_data <- as.matrix(SUNSPOT_seasons)

# Extract the overlapping years between the two datasets
years <- intersect(rownames(tree_ring_df), rownames(SUNSPOT_seasons))

# Subset the tree ring chronology and climatic data based on the overlapping years
rwi <- rwi[match(years, rownames(tree_ring_df))]
climatic_data <- climatic_data[match(years, rownames(SUNSPOT_seasons)), ]

# Calculate correlations and significance for each month
results <- lapply(1:4, function(i) {
  month <- month.abb[i]
  correlation <- cor(rwi, climatic_data[, i], use = "complete.obs")
  p_value <- cor.test(rwi, climatic_data[, i], use = "complete.obs")$p.value
  significant <- p_value <= alpha

  # Remove the unwanted text from the correlation value
  correlation <- gsub(".*cor = ", "", as.character(correlation))

  data.frame(Correlation = correlation, Pvalue = p_value)
})

# Combine the results into a single data frame
results_df <- do.call(rbind, results)

# Display the results data frame
results_df

write.csv(results_df, "CorrelationSUNSPOT_Seasonal.csv")
```


################################################################################


```{r}
cat("\014") 
rm(list=ls()) 
getwd() 
```

**SEMESTER**
*create the correlations + p-values but put it as a data.frame*
```{r}
tree_ring_df <- read.table('Chronology_Stabilized_trees_canela.txt', header = TRUE)
SUNSPOT <- read.table("SUNSPOT_data.txt", header = FALSE)

# Extract the relevant variables from the data
#rwi <- tree_ring_df$RWI[1:nrow(SUNSPOT)]  # Subset the first 31 rows of RWI

Years <- SUNSPOT[,1]
row.names(SUNSPOT) <- Years
SUNSPOT <- SUNSPOT[,-1]

# Define the merged seasons
semester_months <- list(
  Spring_Summer = c(9, 10, 11, 12, 1, 2),
  Autumn_Winter = c(3, 4, 5, 6, 7, 8)
)

# Create a function to calculate merged seasonal means
calculate_merged_semester_means <- function(data, months) {
  merged_semester <- lapply(months, function(x) rowMeans(data[, x, drop = FALSE], na.rm = TRUE))
  merged_semester_df <- as.data.frame(do.call(cbind, merged_semester))
  colnames(merged_semester_df) <- names(months)
  return(merged_semester_df)
}

# Calculate merged seasonal means for temperature_max
SUNSPOT_semester <- calculate_merged_semester_means(SUNSPOT, semester_months)


# Set the significance level (alpha)
alpha <- 0.05

# Extract the relevant columns for correlation
rwi <- tree_ring_df[, 1]
climatic_data <- as.matrix(SUNSPOT_semester)

# Extract the overlapping years between the two datasets
years <- intersect(rownames(tree_ring_df), rownames(SUNSPOT_semester))

# Subset the tree ring chronology and climatic data based on the overlapping years
rwi <- rwi[match(years, rownames(tree_ring_df))]
climatic_data <- climatic_data[match(years, rownames(SUNSPOT_semester)), ]

# Calculate correlations and significance for each month
results <- lapply(1:2, function(i) {
  month <- month.abb[i]
  correlation <- cor(rwi, climatic_data[, i], use = "complete.obs")
  p_value <- cor.test(rwi, climatic_data[, i], use = "complete.obs")$p.value
  significant <- p_value <= alpha

  # Remove the unwanted text from the correlation value
  correlation <- gsub(".*cor = ", "", as.character(correlation))

  data.frame(Correlation = correlation, Pvalue = p_value)
})

# Combine the results into a single data frame
results_df <- do.call(rbind, results)

# Display the results data frame
results_df

write.csv(results_df, "CorrelationSUNSPOT_Semester.csv")
```


################################################################################

```{r}
cat("\014") 
rm(list=ls()) 
getwd() 
```

**ANNUALY**
*create the correlations + p-values but put it as a data.frame*
```{r}
tree_ring_df <- read.table('Chronology_Stabilized_trees_canela.txt', header = TRUE)
SUNSPOT <- read.table("SUNSPOT_data.txt", header = FALSE)

# Extract the relevant variables from the data
#rwi <- tree_ring_df$RWI[1:nrow(SUNSPOT)]  # Subset the first 31 rows of RWI

Years <- SUNSPOT[,1]
row.names(SUNSPOT) <- Years
SUNSPOT <- SUNSPOT[,-1]


# Define the merged seasons
yearly_months <- list(
  Yearly = 1:12  # All months in a year
)

# Create a function to calculate merged seasonal means
calculate_merged_yearly_means <- function(data, months) {
  merged_yearly <- lapply(months, function(x) rowMeans(data[, x, drop = FALSE], na.rm = TRUE))
  merged_yearly_df <- as.data.frame(do.call(cbind, merged_yearly))
  colnames(merged_yearly_df) <- names(months)
  return(merged_yearly_df)
}

# Calculate merged seasonal means for temperature_max
SUNSPOT_yearly <- calculate_merged_yearly_means(SUNSPOT, yearly_months)

# Set the significance level (alpha)
alpha <- 0.05

# Your existing code...

# Extract the relevant columns for correlation
climatic_data <- SUNSPOT_yearly[, 1]
rwi <- tree_ring_df[, 1]

# Subset the climatic_data to match the length of rwi
climatic_data <- climatic_data[1:length(rwi)]

# Calculate correlations and significance for the temperature data
correlation <- cor(rwi, climatic_data, use = "complete.obs")
p_value <- cor.test(rwi, climatic_data, use = "complete.obs")$p.value
significant <- p_value <= alpha

# Remove the unwanted text from the correlation value
correlation <- gsub(".*cor = ", "", as.character(correlation))

# Create a data frame with the results
results_df <- data.frame(Correlation = correlation, Pvalue = p_value)

# Display the results data frame
print(results_df)

# Write the results to a CSV file
write.csv(results_df, "Correlation_SUNSPOT_Yearly.csv")

```
